<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>iOS Settings Final Prototype</title>
  <style>
    @font-face {
      font-family: 'SF Pro Text';
      src: local(-apple-system), local('SF Pro Text'), local('San Francisco');
      font-weight: normal;
    }
    @font-face {
      font-family: 'SF Pro Display';
      src: local(-apple-system), local('SF Pro Display'), local('San Francisco');
      font-weight: bold;
    }
    @font-face {
      font-family: 'SF Pro Text';
      src: local(-apple-system), local('SF Pro Text'), local('San Francisco');
      font-weight: 450;
      font-style: normal;
    }

    /* RESET & BASE STYLES */
    * {
      margin: 0; padding: 0; box-sizing: border-box;
    }
    html, body {
      background-color: #f2f2f7;
      font-family: 'SF Pro Text', -apple-system, system-ui, sans-serif;
      color: #1c1c1e;
      -webkit-font-smoothing: antialiased;
      width: 100%; height: 100%;
      scroll-behavior: smooth;
    }

    .container {
      max-width: 390px;
      min-height: 100vh;
      margin: 20px auto;
      background-color: #f2f2f7;
      position: relative;
      border: 2px solid #aaa;
      border-radius: 40px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    .search-overlay {
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background-color: transparent;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
      z-index: 20;
    }
    .search-overlay.active {
      background-color: rgba(0,0,0,0.4);
      opacity: 1;
      pointer-events: auto;
    }

    /* STATUS BAR */
    .status-bar {
      display: flex; justify-content: space-between; align-items: center;
      padding: 8px 15px; font-size: 14px; color: #1c1c1e;
      z-index: 3; position: relative;
    }
    .status-bar .time {
      font-size: 16px; font-weight: 500; line-height: 1; padding-left: 8px;
    }
    .status-bar .right {
      display: flex; gap: 3px; align-items: center;
    }
    .status-bar img {
      height: 15px; width: auto;
    }
    .status-bar img[alt="LTE Status"] {
      width: 24px; height: auto;
    }
    .status-bar img[alt="Airplane Status"] {
      display: none; width: 18px; height: auto;
    }

    /* HEADER */
    .header {
      font-family: 'SF Pro Display', -apple-system, system-ui, sans-serif;
      font-size: 34px; font-weight: 700;
      margin: 10px 16px 20px;
      letter-spacing: -0.5px;
      z-index: 3; position: relative;
    }

    /* SEARCH BAR */
    .search-container {
      margin: 0 16px 10px; position: relative; z-index: 30;
    }
    .search-bar {
      width: 100%; padding: 10px 45px 10px 40px; border-radius: 22px;
      border: 1px solid #c7c7cc; background-color: #fff;
      font-size: 16px; color: #1c1c1e;
      transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.15s ease;
    }
    .search-bar:focus {
      border-color: #007aff; box-shadow: 0 0 4px rgba(0,122,255,0.3);
      outline: none; transform: scale(0.99);
    }
    .search-bar::placeholder {
      color: rgba(0,0,0,0.4);
    }
    .search-icon {
      position: absolute; left: 14px; top: 10px;
      pointer-events: none; height: 18px; width: auto;
    }
    .clear-icon {
      position: absolute; right: 14px; top: 10px;
      font-size: 16px; color: #8e8e93; cursor: pointer; user-select: none;
      transition: opacity 0.2s ease; opacity: 0;
    }
    .clear-icon.visible {
      opacity: 1;
    }

    /* SEARCH RESULTS */
    .search-results {
      position: absolute; top: 48px; left: 0; right: 0;
      background-color: white; border-radius: 10px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
      max-height: 0; overflow: hidden;
      transition: max-height 0.2s ease;
      z-index: 31;
    }
    .search-results.active {
      max-height: 300px; overflow-y: auto;
    }
    .search-result-item {
      display: flex; align-items: center;
      padding: 12px 16px; border-bottom: 1px solid rgba(60,60,67,0.13);
      cursor: pointer;
    }
    .search-result-item:last-child {
      border-bottom: none;
    }
    .search-result-item:hover {
      background-color: #f2f2f7;
    }
    .search-result-icon {
      width: 26px; height: 26px; border-radius: 6px;
      display: flex; justify-content: center; align-items: center;
      margin-right: 12px; margin-left: -6px; position: relative;
    }
    .search-result-name {
      font-size: 16px; font-weight: 450;
    }
    .search-category {
      font-size: 12px; color: #8e8e93;
      margin-left: auto; padding-left: 8px;
    }
    .search-highlight {
      background-color: rgba(0,122,255,0.1); color: #007aff;
      border-radius: 3px;
    }
    .no-results {
      padding: 16px; text-align: center;
      color: #8e8e93; font-size: 15px;
    }
    .search-result-toggle {
      margin-left: auto; padding-left: 8px;
    }

    /* We'll also define styles for the brightness slider & text size +/- in search results */
    .search-result-control {
      margin-left: auto; display: flex; align-items: center; gap: 8px;
    }
    .search-brightness-range {
      width: 120px; /* smaller slider in the search result */
    }
    .text-size-control button {
      width: 28px; height: 28px; border: none; border-radius: 4px;
      background-color: #e0e0e0; font-size: 18px; cursor: pointer;
    }
    .text-size-control .text-size-value {
      min-width: 32px; text-align: center; font-size: 15px;
    }

    /* PROFILE SECTION */
    .profile-section {
      margin: 0 16px 15px; border-radius: 10px; background-color: #fff;
      border: 1px solid #c7c7cc; overflow: hidden; position: relative;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .profile-item {
      display: flex; align-items: center;
      padding: 16px; cursor: pointer;
      transition: background-color 0.15s ease;
    }
    .profile-item:hover {
      background-color: #f9f9f9;
    }
    .profile-avatar {
      width: 60px; height: 60px; border-radius: 50%;
      background: #e0e0e0; margin-right: 12px; overflow: hidden; flex-shrink: 0;
    }
    .profile-avatar img {
      width: 100%; height: 100%; object-fit: cover;
    }
    .profile-info { display: flex; flex-direction: column; }
    .profile-name {
      font-size: 18px; font-weight: 600; margin-bottom: 2px;
    }
    .profile-email {
      font-size: 13px; color: #8e8e93;
    }
    .profile-chevron {
      margin-left: auto; color: #c7c7cc;
    }

    /* PINNED SECTION */
    .pinned-section {
      position: sticky; top: 0; z-index: 2;
      margin-bottom: 15px; background-color: #f2f2f7;
    }
    .connectivity-controls {
      margin: 0 16px; display: flex; justify-content: space-around; gap: 8px;
    }
    .connectivity-button {
      display: flex; flex-direction: column; align-items: center;
      width: 70px; cursor: pointer;
    }
    .connectivity-icon {
      width: 50px; height: 50px; border-radius: 50%;
      background-color: #c7c7cc; display: flex; justify-content: center; align-items: center;
      margin-bottom: 6px; transition: background-color 0.2s ease;
    }
    .connectivity-icon.icon-wifi.active,
    .connectivity-icon.icon-bluetooth.active {
      background-color: #007aff;
    }
    .connectivity-icon.icon-cellular.active {
      background-color: #34c759;
    }
    .connectivity-icon.icon-airplane.active {
      background-color: #ff9500;
    }
    .connectivity-icon img {
      width: 24px; height: auto;
    }
    .connectivity-label {
      font-size: 12px; text-align: center; color: #1c1c1e;
    }

    /* COLLAPSIBLE SECTIONS */
    .section-header {
      font-weight: 600; font-size: 15px;
      margin: 15px 16px 5px; color: #6e6e73; text-transform: uppercase;
      letter-spacing: 0.4px; z-index: 2; position: relative; cursor: pointer;
      display: flex; align-items: center; justify-content: space-between;
    }
    .collapse-arrow {
      transition: transform 0.15s ease; font-size: 14px; margin-left: 8px;
    }
    .collapsed-arrow { transform: rotate(-90deg); }
    .section {
      margin: 0 16px; border-radius: 10px; background-color: #fff;
      border: 1px solid #c7c7cc; margin-bottom: 15px;
      position: relative; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      max-height: 500px; /* Large enough to fit content */
      overflow: hidden;
      transition: max-height 0.15s ease-in-out; /* Fluid animation */
    }
    .section.collapsed {
      max-height: 0; /* Collapsed state */
    }

    /* SECTIONS & LIST ITEMS */
    .section-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 12px 16px; border-bottom: 1px solid #c7c7cc;
      height: 44px; transition: background-color 0.15s ease; cursor: pointer;
    }
    .section-item:hover { background-color: #f9f9f9; }
    .section-item:active { background-color: #eee; }
    .section-item:last-child { border-bottom: none; }
    .left-content { display: flex; align-items: center; gap: 10px; }
    .item-name { font-size: 16px; font-weight: 400; color: #1c1c1e; }
    .right-content { color: #8e8e93; font-size: 16px; display: flex; align-items: center; }
    .chevron { margin-left: 8px; color: #c7c7cc; }
    .item-icon {
      width: 26px; height: 26px; border-radius: 6px;
      display: flex; justify-content: center; align-items: center;
      flex-shrink: 0; margin-left: -6px; position: relative;
    }
    .item-icon img { width: 20px; height: auto; }

    /* TINTED BACKGROUNDS */
    .section-item .item-icon.icon-wifi { background-color: #007aff; }
    .section-item .item-icon.icon-bluetooth { background-color: #007aff; }
    .section-item .item-icon.icon-battery { background-color: #34c759; }
    .section-item .item-icon.icon-cellular { background-color: #34c759; }
    .section-item .item-icon.icon-display { background-color: #ff9500; }
    .section-item .item-icon.icon-darkmode { background-color: #8e8e93; }
    .section-item .item-icon.icon-text { background-color: #007aff; }
    .section-item .item-icon.icon-update { background-color: #8e8e93; }
    .section-item .item-icon.icon-storage { background-color: #8e8e93; }
    .section-item .item-icon.icon-hotspot { background-color: #34c759; }
    .section-item .item-icon.icon-airplane { background-color: #ff9500; }

    /* BRIGHTNESS SLIDER */
    .brightness-controls { display: flex; align-items: center; gap: 10px; }
    .brightness-range {
      -webkit-appearance: none; appearance: none;
      width: 100px; height: 6px; background: #e9e9eb; border-radius: 3px;
      outline: none; transition: background 0.2s ease;
    }
    .brightness-range::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none;
      width: 18px; height: 18px; border-radius: 50%; background: #007aff;
      cursor: pointer;
    }
    .brightness-range::-moz-range-thumb {
      width: 18px; height: 18px; border-radius: 50%; background: #007aff; cursor: pointer;
    }

    /* TOGGLE SWITCH */
    .toggle-switch {
      width: 51px; height: 31px; background-color: #e9e9eb;
      border-radius: 16px; position: relative;
      transition: all 0.2s ease; cursor: pointer;
    }
    .toggle-switch.active { background-color: #34c759; }
    .toggle-switch::before {
      content: ''; position: absolute; width: 27px; height: 27px;
      border-radius: 50%; background-color: white;
      top: 2px; left: 2px; transition: all 0.2s ease;
      box-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }
    .toggle-switch.active::before {
      transform: translateX(20px);
    }

    /* HOME INDICATOR */
    .home-indicator {
      width: 134px; height: 5px; background: #000; border-radius: 100px;
      margin: 8px auto; position: absolute; bottom: 8px; left: 50%;
      transform: translateX(-50%); z-index: 2;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Search Overlay -->
    <div class="search-overlay"></div>

    <!-- STATUS BAR -->
    <div class="status-bar">
      <div class="time">9:41</div>
      <div class="right">
        <img src="cellularbars.png" alt="Cellular Signal" />
        <img src="wifi-black.png" alt="Wi-Fi Status" />
        <img src="lte.png" alt="LTE Status" style="display: none;" />
        <img src="battery.100percent.bolt.png" alt="Battery" />
        <img src="airplane.png" alt="Airplane Status" />
      </div>
    </div>

    <!-- HEADER -->
    <div class="header">Settings</div>

    <!-- SEARCH BAR -->
    <div class="search-container">
      <input type="text" class="search-bar" placeholder="Search" />
      <img src="magnifyingglass.png" alt="Search Icon" class="search-icon" />
      <span class="clear-icon" role="button" aria-label="Clear search input">×</span>
      <!-- Search Results Dropdown -->
      <div class="search-results"></div>
    </div>

    <!-- PROFILE SECTION -->
    <div class="profile-section">
      <div class="profile-item" tabindex="0" data-setting-id="apple-id">
        <div class="profile-avatar">
          <img src="profile.png" alt="Profile Photo" />
        </div>
        <div class="profile-info">
          <div class="profile-name">John Appleseed</div>
          <div class="profile-email">Apple ID, iCloud, Media & Purchases</div>
        </div>
        <div class="profile-chevron">›</div>
      </div>
    </div>

    <!-- CONTENT CONTAINER -->
    <div class="content-container">
      <!-- PINNED CONNECTIVITY SECTION -->
      <div class="pinned-section">
        <div class="section-header" style="cursor: default;">PINNED</div>
        <div class="connectivity-controls">
          <!-- Wi-Fi button -->
          <div class="connectivity-button" aria-label="Wi-Fi" role="button" data-setting-id="wifi">
            <div class="connectivity-icon icon-wifi">
              <img src="wifi.png" alt="Wi-Fi icon" />
            </div>
            <div class="connectivity-label">Wi-Fi</div>
          </div>
          <!-- Bluetooth button -->
          <div class="connectivity-button" aria-label="Bluetooth" role="button" data-setting-id="bluetooth">
            <div class="connectivity-icon icon-bluetooth">
              <img src="bluetooth.png" alt="Bluetooth icon" />
            </div>
            <div class="connectivity-label">Bluetooth</div>
          </div>
          <!-- Airplane Mode button -->
          <div class="connectivity-button" aria-label="Airplane Mode" role="button" data-setting-id="airplane">
            <div class="connectivity-icon icon-airplane">
              <img src="airplane.png" alt="Airplane Mode icon" />
            </div>
            <div class="connectivity-label">Airplane</div>
          </div>
          <!-- Cellular button -->
          <div class="connectivity-button" aria-label="Cellular" role="button" data-setting-id="cellular">
            <div class="connectivity-icon icon-cellular">
              <img src="antenna.radiowaves.left.and.right.png" alt="Cellular icon" />
            </div>
            <div class="connectivity-label">Cellular</div>
          </div>
        </div>
      </div>

      <!-- Collapsible: "Recently Used" -->
      <div class="section-header" data-collapse-target="#recentlyUsed">
        Recently Used
        <span class="collapse-arrow">▼</span>
      </div>
      <div class="section" id="recentlyUsed">
        <!-- Display Brightness Row with Slider -->
        <div class="section-item" tabindex="0" data-setting-id="display-brightness">
          <div class="left-content">
            <div class="item-icon icon-display">
              <img src="sun.png" alt="Display Brightness Icon" />
            </div>
            <div class="item-name">Display Brightness</div>
          </div>
          <div class="right-content brightness-controls">
            <input type="range" class="brightness-range main-brightness-range" min="0" max="100" value="100" />
          </div>
        </div>
        <!-- Wi-Fi Row with Toggle -->
        <div class="section-item" tabindex="0" data-setting-id="wifi">
          <div class="left-content">
            <div class="item-icon icon-wifi">
              <img src="wifi.png" alt="Wi-Fi icon" />
            </div>
            <div class="item-name">Wi‑Fi</div>
          </div>
          <div class="right-content">
            <div class="toggle-switch" role="switch" aria-checked="false"></div>
          </div>
        </div>
        <!-- Bluetooth Row with Toggle -->
        <div class="section-item" tabindex="0" data-setting-id="bluetooth">
          <div class="left-content">
            <div class="item-icon icon-bluetooth">
              <img src="bluetooth.png" alt="Bluetooth icon" />
            </div>
            <div class="item-name">Bluetooth</div>
          </div>
          <div class="right-content">
            <div class="toggle-switch" role="switch" aria-checked="false"></div>
          </div>
        </div>
        <!-- Low Power Mode Row -->
        <div class="section-item" tabindex="0" data-setting-id="low-power-mode">
          <div class="left-content">
            <div class="item-icon icon-battery">
              <img src="battery.100percent.png" alt="Battery icon" />
            </div>
            <div class="item-name">Low Power Mode</div>
          </div>
          <div class="right-content">
            <div class="toggle-switch" role="switch" aria-checked="false"></div>
          </div>
        </div>
        <!-- Hotspot Row -->
        <div class="section-item" tabindex="0" data-setting-id="hotspot">
          <div class="left-content">
            <div class="item-icon icon-hotspot">
              <img src="hotspot.png" alt="Hotspot icon" />
            </div>
            <div class="item-name">Hotspot</div>
          </div>
          <div class="right-content">
            <div class="toggle-switch" role="switch" aria-checked="false"></div>
          </div>
        </div>
      </div>

      <!-- Display & Appearance -->
      <div class="section-header" data-collapse-target="#displayAppearance">
        Display & Appearance
        <span class="collapse-arrow">▼</span>
      </div>
      <div class="section" id="displayAppearance">
        <div class="section-item" tabindex="0" data-setting-id="auto-dim">
          <div class="left-content">
            <div class="item-icon icon-display">
              <img src="wifi.png" style="opacity: 0;" alt="placeholder" />
              <span style="position:absolute;font-size:14px;opacity:0.9;">⏱️</span>
            </div>
            <div class="item-name">Auto-Dim Display</div>
          </div>
          <div class="right-content">
            <div class="toggle-switch active" role="switch" aria-checked="true"></div>
          </div>
        </div>
        <div class="section-item" tabindex="0" data-setting-id="dark-mode">
          <div class="left-content">
            <div class="item-icon icon-darkmode">
              <img src="wifi.png" style="opacity: 0;" alt="placeholder" />
              <span style="position:absolute;font-size:14px;opacity:0.9;">🌙</span>
            </div>
            <div class="item-name">Dark Mode</div>
          </div>
          <div class="right-content">
            <span>Auto</span>
            <span class="chevron">›</span>
          </div>
        </div>
        <div class="section-item" tabindex="0" data-setting-id="text-size">
          <div class="left-content">
            <div class="item-icon icon-text">
              <img src="wifi.png" style="opacity: 0;" alt="placeholder" />
              <span style="position:absolute;font-size:12px;opacity:0.9;">Aa</span>
            </div>
            <div class="item-name">Text Size</div>
          </div>
          <div class="right-content">
            <span class="chevron">›</span>
          </div>
        </div>
      </div>

      <!-- Connections -->
      <div class="section-header" data-collapse-target="#connectionsSection">
        Connections
        <span class="collapse-arrow">▼</span>
      </div>
      <div class="section" id="connectionsSection">
        <div class="section-item" tabindex="0" data-setting-id="airplane">
          <div class="left-content">
            <div class="item-icon icon-airplane">
              <img src="airplane.png" alt="Airplane Mode icon" />
            </div>
            <div class="item-name">Airplane Mode</div>
          </div>
          <div class="right-content">
            <div class="toggle-switch" role="switch" aria-checked="false"></div>
          </div>
        </div>
        <div class="section-item" tabindex="0" data-setting-id="cellular">
          <div class="left-content">
            <div class="item-icon icon-cellular">
              <img src="antenna.radiowaves.left.and.right.png" alt="Cellular icon" />
            </div>
            <div class="item-name">Cellular</div>
          </div>
          <div class="right-content">
            <div class="toggle-switch" role="switch" aria-checked="false"></div>
          </div>
        </div>
        <div class="section-item" tabindex="0" data-setting-id="wifi-connections">
          <div class="left-content">
            <div class="item-icon icon-wifi">
              <img src="wifi.png" alt="Wi-Fi icon" />
            </div>
            <div class="item-name">Wi‑Fi</div>
          </div>
          <div class="right-content">
            <span>Home_Network</span>
            <span class="chevron">›</span>
          </div>
        </div>
        <div class="section-item" tabindex="0" data-setting-id="bluetooth-connections">
          <div class="left-content">
            <div class="item-icon icon-bluetooth">
              <img src="bluetooth.png" alt="Bluetooth icon" />
            </div>
            <div class="item-name">Bluetooth</div>
          </div>
          <div class="right-content">
            <span>On</span>
            <span class="chevron">›</span>
          </div>
        </div>
      </div>

      <!-- System -->
      <div class="section-header" data-collapse-target="#systemSection">
        System
        <span class="collapse-arrow">▼</span>
      </div>
      <div class="section" id="systemSection">
        <div class="section-item" tabindex="0" data-setting-id="software-update">
          <div class="left-content">
            <div class="item-icon icon-update">
              <img src="wifi.png" style="opacity: 0;" alt="placeholder" />
              <span style="position:absolute;font-size:14px;opacity:0.9;">↻</span>
            </div>
            <div class="item-name">Software Update</div>
          </div>
          <div class="right-content">
            <span>Up to date</span>
            <span class="chevron">›</span>
          </div>
        </div>
        <div class="section-item" tabindex="0" data-setting-id="battery">
          <div class="left-content">
            <div class="item-icon icon-battery">
              <img src="battery.100percent.bolt.png" alt="Battery icon" />
            </div>
            <div class="item-name">Battery</div>
          </div>
          <div class="right-content">
            <span>100%</span>
            <span class="chevron">›</span>
          </div>
        </div>
        <div class="section-item" tabindex="0" data-setting-id="storage">
          <div class="left-content">
            <div class="item-icon icon-storage">
              <img src="wifi.png" style="opacity:0;" alt="placeholder" />
              <span style="position:absolute;font-size:14px;opacity:0.9;">📦</span>
            </div>
            <div class="item-name">Storage</div>
          </div>
          <div class="right-content">
            <span>64.3 GB</span>
            <span class="chevron">›</span>
          </div>
        </div>
      </div>
    </div>

    <!-- HOME INDICATOR -->
    <div class="home-indicator"></div>
  </div>

  <script>
    /*
       SETTINGS DATABASE
    */
    const settingsItems = [
      {
        id: "display-brightness",
        name: "Display Brightness",
        category: "Display & Appearance",
        keywords: ["display", "brightness", "screen", "light", "dim"],
        iconClass: "icon-display",
        hasToggle: false,
        brightnessValue: 100
      },
      {
        id: "wifi",
        name: "Wi‑Fi",
        category: "Connections",
        keywords: ["wifi", "wi-fi", "wireless", "network", "internet"],
        iconClass: "icon-wifi",
        hasToggle: true,
        toggleState: false
      },
      {
        id: "bluetooth",
        name: "Bluetooth",
        category: "Connections",
        keywords: ["bluetooth", "wireless", "headphones", "speaker", "connection"],
        iconClass: "icon-bluetooth",
        hasToggle: true,
        toggleState: false
      },
      {
        id: "airplane",
        name: "Airplane Mode",
        category: "Connections",
        keywords: ["airplane", "flight", "travel", "offline"],
        iconClass: "icon-airplane",
        hasToggle: true,
        toggleState: false
      },
      {
        id: "cellular",
        name: "Cellular",
        category: "Connections",
        keywords: ["cellular", "mobile", "data", "lte", "5g", "4g"],
        iconClass: "icon-cellular",
        hasToggle: true,
        toggleState: false
      },
      {
        id: "low-power-mode",
        name: "Low Power Mode",
        category: "Battery",
        keywords: ["low power", "battery", "save", "energy", "power"],
        iconClass: "icon-battery",
        hasToggle: true,
        toggleState: false
      },
      {
        id: "hotspot",
        name: "Hotspot",
        category: "Connections",
        keywords: ["hotspot", "tethering", "personal", "wifi", "share"],
        iconClass: "icon-hotspot",
        hasToggle: true,
        toggleState: false
      },
      {
        id: "auto-dim",
        name: "Auto-Dim Display",
        category: "Display & Appearance",
        keywords: ["auto", "dim", "display", "screen", "brightness"],
        iconClass: "icon-display",
        hasToggle: true,
        toggleState: true
      },
      {
        id: "dark-mode",
        name: "Dark Mode",
        category: "Display & Appearance",
        keywords: ["dark", "mode", "theme", "appearance", "night"],
        iconClass: "icon-darkmode",
        hasToggle: false
      },
      {
        id: "text-size",
        name: "Text Size",
        category: "Display & Appearance",
        keywords: ["text", "size", "font", "accessibility", "reading"],
        iconClass: "icon-text",
        hasToggle: false,
        textSizeValue: 14
      },
      {
        id: "software-update",
        name: "Software Update",
        category: "System",
        keywords: ["software", "update", "ios", "version", "upgrade"],
        iconClass: "icon-update",
        hasToggle: false
      },
      {
        id: "battery",
        name: "Battery",
        category: "System",
        keywords: ["battery", "power", "charging", "health", "usage"],
        iconClass: "icon-battery",
        hasToggle: false
      },
      {
        id: "storage",
        name: "Storage",
        category: "System",
        keywords: ["storage", "memory", "space", "capacity", "icloud"],
        iconClass: "icon-storage",
        hasToggle: false
      }
    ];

    /* DOM ELEMENTS */
    const searchInput    = document.querySelector('.search-bar');
    const clearIcon      = document.querySelector('.clear-icon');
    const searchOverlay  = document.querySelector('.search-overlay');
    const searchResults  = document.querySelector('.search-results');

    /* COLLAPSIBLE HEADERS */
    document.querySelectorAll('.section-header').forEach(header => {
      header.addEventListener('click', () => {
        const targetSelector = header.getAttribute('data-collapse-target');
        if (!targetSelector) return;
        const sectionElem = document.querySelector(targetSelector);
        if (!sectionElem) return;
        sectionElem.classList.toggle('collapsed');
        const arrow = header.querySelector('.collapse-arrow');
        if (arrow) {
          arrow.classList.toggle('collapsed-arrow');
        }
      });
    });

    /* Searching logic + controlling toggles/sliders from results */
    function toggleClearIcon() {
      if (searchInput.value.length > 0) {
        clearIcon.classList.add('visible');
        searchResults.classList.add('active');
        performSearch(searchInput.value);
      } else {
        clearIcon.classList.remove('visible');
        searchResults.classList.remove('active');
        searchResults.innerHTML = '';
      }
    }

    function performSearch(query) {
      searchResults.innerHTML = '';
      if (!query.trim()) {
        searchResults.classList.remove('active');
        return;
      }
      const lowerQuery = query.toLowerCase();
      const matchedSettings = settingsItems.filter(item => {
        if (item.name.toLowerCase().startsWith(lowerQuery)) return true;
        if (item.name.toLowerCase().includes(lowerQuery)) return true;
        return item.keywords.some(keyword => keyword.toLowerCase().includes(lowerQuery));
      });
      matchedSettings.sort((a, b) => {
        const aNameLower = a.name.toLowerCase();
        const bNameLower = b.name.toLowerCase();
        if (aNameLower === lowerQuery && bNameLower !== lowerQuery) return -1;
        if (bNameLower === lowerQuery && aNameLower !== lowerQuery) return 1;
        if (aNameLower.startsWith(lowerQuery) && !bNameLower.startsWith(lowerQuery)) return -1;
        if (bNameLower.startsWith(lowerQuery) && !aNameLower.startsWith(lowerQuery)) return 1;
        return a.name.localeCompare(b.name);
      });
      if (matchedSettings.length === 0) {
        searchResults.innerHTML = `<div class="no-results">No Settings Found</div>`;
        return;
      }

      matchedSettings.forEach(item => {
        const resultItem = document.createElement('div');
        resultItem.className = 'search-result-item';
        resultItem.setAttribute('data-setting-id', item.id);

        const itemNameLower = item.name.toLowerCase();
        const startIndex = itemNameLower.indexOf(lowerQuery);
        let highlightedName = item.name;
        if (startIndex !== -1) {
          const endIndex = startIndex + lowerQuery.length;
          highlightedName =
            item.name.substring(0, startIndex) +
            `<span class="search-highlight">${item.name.substring(startIndex, endIndex)}</span>` +
            item.name.substring(endIndex);
        }

        let resultContent = `
          <div class="search-result-icon ${item.iconClass}">
            <img src="wifi.png" style="opacity: 0;" alt="" />
            <span style="position:absolute;font-size:14px;opacity:0.9;">⚙️</span>
          </div>
          <div class="search-result-name">${highlightedName}</div>
        `;

        let rightSideHTML = '';
        if (item.id === 'display-brightness') {
          rightSideHTML = `
            <div class="search-result-control">
              <input type="range"
                     class="brightness-range search-brightness-range"
                     min="0" max="100" value="${item.brightnessValue || 100}" />
            </div>
          `;
        } else if (item.id === 'text-size') {
          rightSideHTML = `
            <div class="search-result-control text-size-control">
              <button class="text-size-decrement">–</button>
              <span class="text-size-value">${item.textSizeValue || 14}</span>
              <button class="text-size-increment">+</button>
            </div>
          `;
        } else if (item.hasToggle) {
          const toggleStateClass = item.toggleState ? 'active' : '';
          rightSideHTML = `
            <div class="search-result-toggle">
              <div class="toggle-switch ${toggleStateClass}"
                   role="switch"
                   aria-checked="${item.toggleState}"
                   data-setting-id="${item.id}">
              </div>
            </div>
          `;
        } else {
          rightSideHTML = `<div class="search-category">${item.category}</div>`;
        }

        resultItem.innerHTML = resultContent + rightSideHTML;

        resultItem.addEventListener('click', (e) => {
          if (
            e.target.closest('.toggle-switch') ||
            e.target.closest('.search-brightness-range') ||
            e.target.closest('.text-size-control')
          ) {
            return;
          }
          navigateToSetting(item.id);
        });

        searchResults.appendChild(resultItem);
      });

      document.querySelectorAll('.search-results .toggle-switch').forEach(toggle => {
        toggle.addEventListener('click', function(e) {
          e.stopPropagation();
          const wasActive = this.classList.contains('active');
          this.classList.toggle('active');
          const isActive = this.classList.contains('active');
          this.setAttribute('aria-checked', isActive ? 'true' : 'false');
          const settingId = this.getAttribute('data-setting-id');
          const mainToggle = document.querySelector(`.section-item[data-setting-id="${settingId}"] .toggle-switch`);
          if (mainToggle) {
            mainToggle.classList.toggle('active', isActive);
            mainToggle.setAttribute('aria-checked', isActive ? 'true' : 'false');
          }
          const settingItem = settingsItems.find(i => i.id === settingId);
          if (settingItem) {
            settingItem.toggleState = isActive;
            if (settingId === "airplane") {
              if (isActive) {
                turnOnAirplane();
              } else {
                turnOffAirplane();
              }
            } else if (["wifi", "bluetooth", "cellular"].includes(settingId)) {
              syncToggleState(settingId, isActive);
            }
          }
          if (navigator.vibrate) {
            navigator.vibrate(5);
          }
        });
      });

      document.querySelectorAll('.search-results .search-brightness-range').forEach(slider => {
        slider.addEventListener('input', function(e) {
          e.stopPropagation();
          const parentItem = this.closest('.search-result-item');
          if (!parentItem) return;
          const settingId = parentItem.getAttribute('data-setting-id');
          const settingItem = settingsItems.find(i => i.id === settingId);
          if (!settingItem) return;
          const newVal = parseInt(this.value, 10);
          settingItem.brightnessValue = newVal;
          const mainSlider = document.querySelector('.main-brightness-range');
          if (mainSlider && settingId === 'display-brightness') {
            mainSlider.value = newVal;
          }
          updateScreenBrightness(newVal);
        });
      });

      document.querySelectorAll('.search-results .text-size-control').forEach(control => {
        const parentItem = control.closest('.search-result-item');
        if (!parentItem) return;
        const settingId = parentItem.getAttribute('data-setting-id');
        const settingItem = settingsItems.find(i => i.id === settingId);
        if (!settingItem) return;

        const minusBtn = control.querySelector('.text-size-decrement');
        const plusBtn  = control.querySelector('.text-size-increment');
        const valSpan  = control.querySelector('.text-size-value');

        minusBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          settingItem.textSizeValue = Math.max(8, (settingItem.textSizeValue || 14) - 1);
          valSpan.textContent = settingItem.textSizeValue;
        });
        plusBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          settingItem.textSizeValue = Math.min(72, (settingItem.textSizeValue || 14) + 1);
          valSpan.textContent = settingItem.textSizeValue;
        });
      });
    }

    // Expand section if collapsed, scroll to item
    function navigateToSetting(settingId) {
      const targetSetting = document.querySelector(`.section-item[data-setting-id="${settingId}"]`);
      if (targetSetting) {
        const parentSection = targetSetting.closest('.section');
        if (parentSection && parentSection.classList.contains('collapsed')) {
          parentSection.classList.remove('collapsed');
          const header = document.querySelector(`.section-header[data-collapse-target="#${parentSection.id}"]`);
          if (header) {
            const arrow = header.querySelector('.collapse-arrow');
            if (arrow) {
              arrow.classList.remove('collapsed-arrow');
            }
          }
        }

        searchInput.value = '';
        searchResults.classList.remove('active');
        searchOverlay.classList.remove('active');
        toggleClearIcon();

        targetSetting.style.backgroundColor = '#e6f2ff';
        targetSetting.scrollIntoView({ behavior: 'smooth', block: 'center' });
        targetSetting.focus();
        setTimeout(() => { targetSetting.style.backgroundColor = ''; }, 1500);
      }
    }

    // main toggles within sections
    document.querySelectorAll('.section-item .toggle-switch').forEach(toggle => {
      toggle.addEventListener('click', function(e) {
        e.stopPropagation();
        const wasActive = this.classList.contains('active');
        this.classList.toggle('active');
        const isActive = this.classList.contains('active');
        this.setAttribute('aria-checked', isActive ? 'true' : 'false');
        const itemRow = this.closest('.section-item');
        if (itemRow) {
          const settingId = itemRow.getAttribute('data-setting-id');
          const settingData = settingsItems.find(i => i.id === settingId);
          if (settingData) {
            settingData.toggleState = isActive;
            if (settingId === "airplane") {
              if (isActive) {
                turnOnAirplane();
              } else {
                turnOffAirplane();
              }
            } else {
              if (["wifi", "bluetooth", "cellular", "hotspot"].includes(settingId) && isActive) {
                const airplaneItem = settingsItems.find(a => a.id === "airplane");
                if (airplaneItem && airplaneItem.toggleState) {
                  turnOffAirplane();
                }
              }
              if (["wifi", "bluetooth", "cellular"].includes(settingId)) {
                syncToggleState(settingId, isActive);
              }
              if (settingId === "hotspot" && isActive) {
                const cellularItem = settingsItems.find(i => i.id === "cellular");
                if (cellularItem && !cellularItem.toggleState) {
                  syncToggleState("cellular", true);
                  cellularItem.toggleState = true;
                }
              }
              if (settingId === "low-power-mode") {
                updateBatteryStatusIcon();
              }
            }
          }
        }
        if (navigator.vibrate) {
          navigator.vibrate(5);
        }
      });
    });

    // pinned connectivity toggles
    document.querySelectorAll('.connectivity-button').forEach(button => {
      button.addEventListener('click', function() {
        const icon = this.querySelector('.connectivity-icon');
        const settingId = this.getAttribute('data-setting-id');
        const wasActive = icon.classList.contains('active');
        icon.classList.toggle('active');
        const isActive = icon.classList.contains('active');

        if (settingId === "airplane") {
          const planeItem = settingsItems.find(i => i.id === "airplane");
          if (planeItem) {
            planeItem.toggleState = isActive;
          }
          if (!wasActive) {
            turnOnAirplane();
          } else {
            turnOffAirplane();
          }
        } else {
          if (["wifi", "bluetooth", "cellular", "hotspot"].includes(settingId) && isActive) {
            const airplaneItem = settingsItems.find(a => a.id === "airplane");
            if (airplaneItem && airplaneItem.toggleState) {
              turnOffAirplane();
            }
          }
          if (settingId === "hotspot" && isActive) {
            const cellularItem = settingsItems.find(i => i.id === "cellular");
            if (cellularItem && !cellularItem.toggleState) {
              syncToggleState("cellular", true);
              cellularItem.toggleState = true;
            }
          }
          syncToggleState(settingId, isActive);
        }
        if (navigator.vibrate) {
          navigator.vibrate(5);
        }
      });
    });

    /* Turn ON airplane => disable wifi/bt/cellular/hotspot */
    function turnOnAirplane() {
      ["wifi", "bluetooth", "cellular", "hotspot"].forEach(id => {
        const pinnedIcon = document.querySelector(`.connectivity-button[data-setting-id="${id}"] .connectivity-icon`);
        const settingItem = settingsItems.find(s => s.id === id);
        const mainToggle = document.querySelector(`.section-item[data-setting-id="${id}"] .toggle-switch`);
        if ((pinnedIcon && pinnedIcon.classList.contains('active')) || 
            (mainToggle && mainToggle.classList.contains('active'))) {
          if (pinnedIcon) pinnedIcon.classList.remove('active');
          if (mainToggle) {
            mainToggle.classList.remove('active');
            mainToggle.setAttribute('aria-checked', 'false');
          }
          if (settingItem) {
            settingItem.toggleState = false;
          }
          syncToggleState(id, false);
        }
      });
      const airplaneToggle = document.querySelector('.section-item[data-setting-id="airplane"] .toggle-switch');
      if (airplaneToggle) {
        airplaneToggle.classList.add('active');
        airplaneToggle.setAttribute('aria-checked', 'true');
      }
      const airplanePinned = document.querySelector('.connectivity-button[data-setting-id="airplane"] .connectivity-icon');
      if (airplanePinned) {
        airplanePinned.classList.add('active');
      }
      const airplaneItem = settingsItems.find(s => s.id === "airplane");
      if (airplaneItem) {
        airplaneItem.toggleState = true;
      }
      showAirplaneStatus(true);
    }

    /* Turn OFF airplane => user can re-enable wifi etc. */
    function turnOffAirplane() {
      const planeItem = settingsItems.find(s => s.id === "airplane");
      if (planeItem) {
        planeItem.toggleState = false;
      }
      const pinnedIcon = document.querySelector('.connectivity-button[data-setting-id="airplane"] .connectivity-icon');
      if (pinnedIcon) {
        pinnedIcon.classList.remove('active');
      }
      const mainToggle = document.querySelector('.section-item[data-setting-id="airplane"] .toggle-switch');
      if (mainToggle) {
        mainToggle.classList.remove('active');
        mainToggle.setAttribute('aria-checked', 'false');
      }
      showAirplaneStatus(false);
    }

    /* Show/hide icons for airplane mode (battery always on) */
    function showAirplaneStatus(isOn) {
      const airplaneIconTop = document.querySelector('.status-bar img[alt="Airplane Status"]');
      const cellIcon = document.querySelector('.status-bar img[alt="Cellular Signal"]');
      const wifiIcon = document.querySelector('.status-bar img[alt="Wi-Fi Status"]');
      const lteIcon  = document.querySelector('.status-bar img[alt="LTE Status"]');
      const batteryIcon = document.querySelector('.status-bar img[alt="Battery"]');

      if (batteryIcon) batteryIcon.style.display = 'inline';
      if (airplaneIconTop) {
        airplaneIconTop.style.display = isOn ? 'inline' : 'none';
      }
      if (isOn) {
        if (cellIcon) cellIcon.style.display = 'none';
        if (wifiIcon) wifiIcon.style.display = 'none';
        if (lteIcon)  lteIcon.style.display  = 'none';
      } else {
        if (cellIcon) cellIcon.style.display = 'inline';
        const wifiSetting = settingsItems.find(s => s.id === "wifi");
        const cellularSetting = settingsItems.find(s => s.id === "cellular");
        if (wifiIcon) wifiIcon.style.display = wifiSetting?.toggleState ? 'inline' : 'none';
        if (lteIcon)  lteIcon.style.display = cellularSetting?.toggleState ? 'inline' : 'none';
      }
    }

    /* sync pinned vs main toggles, update status bar icons */
    function syncToggleState(settingId, newState) {
      const pinnedIcon = document.querySelector(`.connectivity-button[data-setting-id="${settingId}"] .connectivity-icon`);
      if (pinnedIcon) {
        pinnedIcon.classList.toggle('active', newState);
      }
      const mainToggle = document.querySelector(`.section-item[data-setting-id="${settingId}"] .toggle-switch`);
      if (mainToggle) {
        mainToggle.classList.toggle('active', newState);
        mainToggle.setAttribute('aria-checked', newState ? 'true' : 'false');
      }
      const settingData = settingsItems.find(i => i.id === settingId);
      if (settingData && settingData.hasToggle) {
        settingData.toggleState = newState;
      }
      if (settingId === "wifi") {
        const wifiStatusIcon = document.querySelector('.status-bar img[alt="Wi-Fi Status"]');
        if (wifiStatusIcon) {
          wifiStatusIcon.style.display = newState ? 'inline' : 'none';
        }
      }
      if (settingId === "cellular") {
        const lteStatusIcon = document.querySelector('.status-bar img[alt="LTE Status"]');
        if (lteStatusIcon) {
          lteStatusIcon.style.display = newState ? 'inline' : 'none';
        }
      }
    }

    /* update battery icon if low-power-mode changes */
    function updateBatteryStatusIcon() {
      const batteryImg = document.querySelector('.status-bar img[alt="Battery"]');
      const lowPowerSetting = settingsItems.find(item => item.id === "low-power-mode");
      if (batteryImg && lowPowerSetting) {
        batteryImg.src = lowPowerSetting.toggleState
          ? "battery.100percent.yello.png"
          : "battery.100percent.bolt.png";
      }
    }

    /* Update screen brightness for prototype */
    function updateScreenBrightness(value) {
      const container = document.querySelector('.container');
      const brightness = 0.5 + (value / 100) * 0.5;
      container.style.filter = `brightness(${brightness})`;
    }

    // search bar events
    searchInput.addEventListener('input', toggleClearIcon);
    clearIcon.addEventListener('click', () => {
      searchInput.value = '';
      toggleClearIcon();
      searchInput.focus();
    });
    searchInput.addEventListener('focus', function() {
      searchOverlay.classList.add('active');
      this.style.transform = 'scale(0.99)';
      if (this.value.trim().length > 0) {
        searchResults.classList.add('active');
        performSearch(this.value);
      }
    });
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.search-container')) {
        searchResults.classList.remove('active');
        searchOverlay.classList.remove('active');
      }
    });
    document.addEventListener('keydown', function(e) {
      if (!e.ctrlKey && !e.metaKey && !e.altKey &&
          e.key.length === 1 &&
          document.activeElement !== searchInput &&
          document.activeElement.tagName !== 'INPUT') {
        searchInput.focus();
        if (searchInput.value.length === 0) {
          searchInput.value = e.key;
          toggleClearIcon();
          e.preventDefault();
        }
      }
    });

    /* On load, sync pinned toggles and status bar icons */
    window.addEventListener('DOMContentLoaded', () => {
      ["wifi", "bluetooth", "airplane", "cellular"].forEach(id => {
        const item = settingsItems.find(s => s.id === id);
        if (item) {
          syncToggleState(id, item.toggleState);
        }
      });
      const wifiStatusIcon = document.querySelector('.status-bar img[alt="Wi-Fi Status"]');
      const wifiSetting = settingsItems.find(i => i.id === "wifi");
      if (wifiStatusIcon && wifiSetting) {
        wifiStatusIcon.style.display = wifiSetting.toggleState ? 'inline' : 'none';
      }
      const lteStatusIcon = document.querySelector('.status-bar img[alt="LTE Status"]');
      const cellularSetting = settingsItems.find(i => i.id === "cellular");
      if (lteStatusIcon && cellularSetting) {
        lteStatusIcon.style.display = cellularSetting.toggleState ? 'inline' : 'none';
      }
      const planeItem = settingsItems.find(i => i.id === "airplane");
      if (planeItem && planeItem.toggleState) {
        showAirplaneStatus(true);
      } else {
        showAirplaneStatus(false);
      }

      const brightnessItem = settingsItems.find(i => i.id === "display-brightness");
      if (brightnessItem) {
        const mainSlider = document.querySelector('.main-brightness-range');
        if (mainSlider) {
          mainSlider.value = brightnessItem.brightnessValue || 100;
          updateScreenBrightness(mainSlider.value);
          mainSlider.addEventListener('input', function() {
            brightnessItem.brightnessValue = parseInt(this.value, 10);
            updateScreenBrightness(this.value);
          });
        }
      }
    });
  </script>
</body>
</html>
